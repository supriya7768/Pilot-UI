<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="shortcut icon"
      href="assets/images/favicon.svg"
      type="image/x-icon"
    />
    <title>Shepherd</title>
    <!-- ========== All CSS files linkup ========= -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css" />
    <link
      rel="stylesheet"
      href="assets/css/lineicons.css"
      rel="stylesheet"
      type="text/css"
    />
    <link
      rel="stylesheet"
      href="assets/css/materialdesignicons.min.css"
      rel="stylesheet"
      type="text/css"
    />
    <link rel="stylesheet" href="assets/css/fullcalendar.css" />
    <link rel="stylesheet" href="assets/css/fullcalendar.css" />
    <link rel="stylesheet" href="assets/css/main.css" />
  </head>

  <body>
    <!-- ======== Preloader =========== -->
    <div id="preloader">
      <div class="spinner"></div>
    </div>
    <!-- ======== Preloader =========== -->
    <!-- ======== sidebar-nav start =========== -->
    <aside class="sidebar-nav-wrapper">
      <div class="navbar-logo">
        <a href="index.html">
          <img
            style="height: 150px; width: 150px"
            src="./assets/images/SHEPHERD 2.jpg"
          />
        </a>
      </div>
      <nav class="sidebar-nav">
        <ul>
          <li class="nav-item">
            <a href="index.html">
              <span class="icon">
                <img class="hi" src="./assets/images/dashboard.png" alt="" />
              </span>
              <span class="text">Dashboard</span>
            </a>
          </li>
        </ul>
      </nav>
      <nav class="sidebar-nav">
        <ul>
          <li class="nav-item">
            <a href="addlead.html">
              <span class="icon">
                <img class="hi" src="./assets/images/user.png" alt="" />
              </span>
              <span class="text">Add Lead</span>
            </a>
          </li>
        </ul>
      </nav>
      <nav class="sidebar-nav">
        <ul>
          <li class="nav-item">
            <a href="leadlist.html">
              <span class="icon">
                <img class="hi" src="./assets/images/group.png" alt="" />
              </span>
              <span class="text">Lead List</span>
            </a>
          </li>
        </ul>
      </nav>
      <nav class="sidebar-nav">
        <ul>
          <li class="nav-item">
            <a href="invoice.html">
              <span class="icon">
                <img class="hi" src="./assets/images/invoice.png" alt="" />
              </span>
              <span class="text">Invoice</span>
            </a>
          </li>
        </ul>
      </nav>
      <nav class="sidebar-nav">
        <ul>
          <li class="nav-item">
            <a href="studentpanel.html">
              <span class="icon">
                <img class="hi" src="./assets/images/students.png" alt="" />
              </span>
              <span class="text">Student Panel</span>
            </a>
          </li>
        </ul>
      </nav>
      <nav class="sidebar-nav">
        <ul>
          <li class="nav-item">
            <a href="adminpanel.html">
              <span class="icon">
                <img class="hi" src="./assets/images/admin.png" alt="" />
              </span>
              <span class="text">Admin Panel</span>
            </a>
          </li>
        </ul>
      </nav>
    </aside>
    <!-- ======== sidebar-nav end =========== -->
    <div class="overlay"></div>
    <!-- ======== sidebar-nav end =========== -->
    <!-- ======== main-wrapper start =========== -->
    <main class="main-wrapper">
      <!-- ========== header start ========== -->
      <header class="header">
        <div class="container-fluid">
          <div class="row">
            <div class="col-lg-5 col-md-5 col-6">
              <div class="header-left d-flex align-items-center">
                <div class="menu-toggle-btn mr-15">
                  <button
                    id="menu-toggle"
                    class="main-btn primary-btn btn-hover"
                  >
                    <i class="lni lni-chevron-left me-2"></i> Menu
                  </button>
                </div>
              </div>
            </div>
            <div class="col-lg-7 col-md-7 col-6">
              <div class="header-right">
                <!-- notification start -->
                <div class="notification-box ml-15 d-none d-md-flex">
                  <button
                    class="dropdown-toggle"
                    type="button"
                    id="notification"
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                  >
                    <svg
                      width="22"
                      height="22"
                      viewBox="0 0 22 22"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        d="M11 20.1667C9.88317 20.1667 8.88718 19.63 8.23901 18.7917H13.761C13.113 19.63 12.1169 20.1667 11 20.1667Z"
                        fill=""
                      />
                      <path
                        d="M10.1157 2.74999C10.1157 2.24374 10.5117 1.83333 11 1.83333C11.4883 1.83333 11.8842 2.24374 11.8842 2.74999V2.82604C14.3932 3.26245 16.3051 5.52474 16.3051 8.24999V14.287C16.3051 14.5301 16.3982 14.7633 16.564 14.9352L18.2029 16.6342C18.4814 16.9229 18.2842 17.4167 17.8903 17.4167H4.10961C3.71574 17.4167 3.5185 16.9229 3.797 16.6342L5.43589 14.9352C5.6017 14.7633 5.69485 14.5301 5.69485 14.287V8.24999C5.69485 5.52474 7.60672 3.26245 10.1157 2.82604V2.74999Z"
                        fill=""
                      />
                    </svg>
                    <span></span>
                  </button>
                  <ul
                    class="dropdown-menu dropdown-menu-end"
                    aria-labelledby="notification"
                  >
                    <li>
                      <a href="#0">
                        <div class="image">
                          <img src="assets/images/lead/lead-6.png" alt="" />
                        </div>
                        <div class="content">
                          <h6>
                            John Doe
                            <span class="text-regular">
                              comment on a product.
                            </span>
                          </h6>
                          <p>
                            Lorem ipsum dolor sit amet, consect etur adipiscing
                            elit Vivamus tortor.
                          </p>
                          <span>10 mins ago</span>
                        </div>
                      </a>
                    </li>
                    <li>
                      <a href="#0">
                        <div class="image">
                          <img src="assets/images/lead/lead-1.png" alt="" />
                        </div>
                        <div class="content">
                          <h6>
                            Jonathon
                            <span class="text-regular">
                              like on a product.
                            </span>
                          </h6>
                          <p>
                            Lorem ipsum dolor sit amet, consect etur adipiscing
                            elit Vivamus tortor.
                          </p>
                          <span>10 mins ago</span>
                        </div>
                      </a>
                    </li>
                  </ul>
                </div>
                <!-- notification end -->
                <!-- message start -->
                <div class="header-message-box ml-15 d-none d-md-flex">
                  <button
                    class="dropdown-toggle"
                    type="button"
                    id="message"
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                  >
                    <svg
                      width="22"
                      height="22"
                      viewBox="0 0 22 22"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        d="M7.74866 5.97421C7.91444 5.96367 8.08162 5.95833 8.25005 5.95833C12.5532 5.95833 16.0417 9.4468 16.0417 13.75C16.0417 13.9184 16.0364 14.0856 16.0259 14.2514C16.3246 14.138 16.6127 14.003 16.8883 13.8482L19.2306 14.629C19.7858 14.8141 20.3141 14.2858 20.129 13.7306L19.3482 11.3882C19.8694 10.4604 20.1667 9.38996 20.1667 8.25C20.1667 4.70617 17.2939 1.83333 13.75 1.83333C11.0077 1.83333 8.66702 3.55376 7.74866 5.97421Z"
                        fill=""
                      />
                      <path
                        d="M14.6667 13.75C14.6667 17.2938 11.7939 20.1667 8.25004 20.1667C7.11011 20.1667 6.03962 19.8694 5.11182 19.3482L2.76946 20.129C2.21421 20.3141 1.68597 19.7858 1.87105 19.2306L2.65184 16.8882C2.13062 15.9604 1.83338 14.89 1.83338 13.75C1.83338 10.2062 4.70622 7.33333 8.25004 7.33333C11.7939 7.33333 14.6667 10.2062 14.6667 13.75ZM5.95838 13.75C5.95838 13.2437 5.54797 12.8333 5.04171 12.8333C4.53545 12.8333 4.12504 13.2437 4.12504 13.75C4.12504 14.2563 4.53545 14.6667 5.04171 14.6667C5.54797 14.6667 5.95838 14.2563 5.95838 13.75ZM9.16671 13.75C9.16671 13.2437 8.7563 12.8333 8.25004 12.8333C7.74379 12.8333 7.33338 13.2437 7.33338 13.75C7.33338 14.2563 7.74379 14.6667 8.25004 14.6667C8.7563 14.6667 9.16671 14.2563 9.16671 13.75ZM11.4584 14.6667C11.9647 14.6667 12.375 14.2563 12.375 13.75C12.375 13.2437 11.9647 12.8333 11.4584 12.8333C10.9521 12.8333 10.5417 13.2437 10.5417 13.75C10.5417 14.2563 10.9521 14.6667 11.4584 14.6667Z"
                        fill=""
                      />
                    </svg>
                    <span></span>
                  </button>
                  <ul
                    class="dropdown-menu dropdown-menu-end"
                    aria-labelledby="message"
                  >
                    <li>
                      <a href="#0">
                        <div class="image">
                          <img src="assets/images/lead/lead-5.png" alt="" />
                        </div>
                        <div class="content">
                          <h6>Jacob Jones</h6>
                          <p>Hey!I can across your profile and ...</p>
                          <span>10 mins ago</span>
                        </div>
                      </a>
                    </li>
                    <li>
                      <a href="#0">
                        <div class="image">
                          <img src="assets/images/lead/lead-3.png" alt="" />
                        </div>
                        <div class="content">
                          <h6>John Doe</h6>
                          <p>Would you mind please checking out</p>
                          <span>12 mins ago</span>
                        </div>
                      </a>
                    </li>
                    <li>
                      <a href="#0">
                        <div class="image">
                          <img src="assets/images/lead/lead-2.png" alt="" />
                        </div>
                        <div class="content">
                          <h6>Anee Lee</h6>
                          <p>Hey! are you available for freelance?</p>
                          <span>1h ago</span>
                        </div>
                      </a>
                    </li>
                  </ul>
                </div>
                <!-- message end -->
                <!-- profile start -->
                <div class="profile-box ml-15">
                  <button
                    class="dropdown-toggle bg-transparent border-0"
                    type="button"
                    id="profile"
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                  >
                    <div class="profile-info">
                      <div class="info">
                        <div class="image">
                          <img src="assets/images/logo.png" alt="" />
                        </div>
                        <div>
                          <h6 class="fw-500">Testing Shastra</h6>
                          <p>Admin</p>
                        </div>
                      </div>
                    </div>
                  </button>
                  <ul
                    class="dropdown-menu dropdown-menu-end"
                    aria-labelledby="profile"
                  >
                    <li>
                      <div class="author-info flex items-center !p-1">
                        <div class="image">
                          <img
                            src="assets/images/profile/profile-image.png"
                            alt="image"
                          />
                        </div>
                        <div class="content">
                          <h4 class="text-sm">Adam Joe</h4>
                          <!-- <a class="text-black/40 dark:text-white/40 hover:text-black dark:hover:text-white text-xs" href="#">Email@gmail.com</a> -->
                        </div>
                      </div>
                    </li>
                    <li class="divider"></li>
                    <li>
                      <a href="#0">
                        <i class="lni lni-user"></i> View Profile
                      </a>
                    </li>
                    <li>
                      <a href="#0">
                        <i class="lni lni-alarm"></i> Notifications
                      </a>
                    </li>
                    <li>
                      <a href="#0"> <i class="lni lni-inbox"></i> Messages </a>
                    </li>
                    <li>
                      <a href="#0"> <i class="lni lni-cog"></i> Settings </a>
                    </li>
                    <li class="divider"></li>
                    <li>
                      <a href="#0"> <i class="lni lni-exit"></i> Sign Out </a>
                    </li>
                  </ul>
                </div>
                <!-- profile end -->
              </div>
            </div>
          </div>
        </div>
      </header>
      <!-- ========== header end ========== -->
      <!-- ========== section start ========== -->
      <section class="section">
        <div class="container-fluid">
          <!-- ========== title-wrapper start ========== -->
          <div class="title-wrapper pt-30">
            <div class="row align-items-center">
              <div class="col-md-6">
                <div class="title">
                  <h2>Hello, Testing Shastra</h2>
                </div>
              </div>
            </div>

            <div>
              <div class="col-lg-5 text-sm">
                <div class="card-style calendar-card mb-30">
                  <div id="calendar-mini" class="calendar2"></div>
                </div>
              </div>
              <!-- End Col -->
              <div class="col-lg-7 w-100 text-xs">
                <div class="card-style mb-30">
                  <div
                    class="title d-flex flex-wrap align-items-center justify-content-between"
                  >
                    <div class="left">
                      <h6 class="text-small mb-30">Follow Up</h6>
                    </div>
                    <div class="right">
                      <div class="select-style-1">
                        <!-- <h4>Check leads on</h4> -->
                        <input type="date" id="followDateInput" />
                      </div>
                      <!-- end select -->
                    </div>
                  </div>
                  <!-- End Title -->
                  <div class="table-responsive">
                    <table class="table top-selling-table">
                      <thead>
                        <tr>
                          <th>
                            <h6>Name</h6>
                          </th>
                          <th>
                            <h6>Mobile No</h6>
                          </th>
                          <th>
                            <h6>Last Comment</h6>
                          </th>
                          <th>
                            <h6>Follow On</h6>
                          </th>
                          <th>
                            <h6>Status</h6>
                          </th>
                          <th>
                            <h6>Action</h6>
                          </th>
                        </tr>
                        <!-- end table row-->
                      </thead>

                      <tbody id="leadTable">
                        <!--Adding Leads Dynamically-->
                      </tbody>
                    </table>
                    <!-- End Table -->
                  </div>
                </div>
              </div>
              <!-- End Col -->
            </div>
            <!-- End Row -->
          </div>
          <!-- end container -->
          <!-- </section> -->
          <!-- ========== section end ========== -->

          <!-- </main> -->
          <!-- ======== main-wrapper end =========== -->

          <!-- ========= All Javascript files linkup ======== -->
          <script src="assets/js/bootstrap.bundle.min.js"></script>
          <script src="assets/js/Chart.min.js"></script>
          <script src="assets/js/dynamic-pie-chart.js"></script>
          <script src="assets/js/moment.min.js"></script>
          <script src="assets/js/fullcalendar.js"></script>
          <script src="assets/js/jvectormap.min.js"></script>
          <script src="assets/js/world-merc.js"></script>
          <script src="assets/js/polyfill.js"></script>
          <script src="assets/js/main.js"></script>
          <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
          <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
          <script src="./assets/js/newcalender.js"></script>
          <!-- <script src="./assets/js/user.js"></script> -->
          <script src="./assets/js/jquery.js"></script>

          <script>
            document.addEventListener("DOMContentLoaded", function () {
              var calendarMiniEl = document.getElementById("calendar-mini");
              var calendarMini = new FullCalendar.Calendar(calendarMiniEl, {
                initialView: "dayGridMonth",
                headerToolbar: {
                  end: "today prev,next",
                },
              });
              calendarMini.render();
            });
          </script>

          <script>
            function fetchLeadsByDate(selectedDate) {
              fetch("http://localhost:8080/get-lead-data-dashboard")
                .then((response) => response.json())
                .then((data) => {
                  const leadData = document.getElementById("leadTable");
                  leadData.innerHTML = ""; // Clear existing data

                  data
                    .filter(
                      (lead) =>
                        lead.status === "Active" || lead.status === "Pending"
                    )
                    .forEach((lead) => {
                      const followDate = lead.follow.split("T")[0]; // Assuming the follow date is in 'YYYY-MM-DD' format

                      if (followDate === selectedDate) {
                        const row = document.createElement("tr");
                        row.dataset.leadId = lead.id;
                        row.innerHTML = `
            <td>${lead.name}</td>
            <td>${lead.mobile}</td>
            <td>${lead.comment}</td>
            <td>${lead.follow}</td>
            <td>${lead.status}</td>
            <td>    
              <div class="action">
                ${
                  lead.status === "Pending"
                    ? `
                    <select onchange="changeStatus(this)" style="color: black;">
                      <option value="">Select</option>
                      <option value="Active">Active</option>
                      <option value="Done">Done</option>
                      <option value="Close">Close</option>
                    </select>
                  `
                    : lead.status === "Active"
                    ? `
                      <select onchange="changeStatus(this)" style="color: black;">
                        <option value="">Select</option>
                        <option value="Pending">Pending</option>
                        <option value="Done">Done</option>
                        <option value="Close">Close</option>
                      </select>
                    `
                    : lead.status === "Done"
                    ? `
                        <a href="invoice.html?leadName=${lead.name}&leadEmail=${lead.email}" class="create-invoice-link" style="color: purple;">Invoice</a>
                      `
                    : lead.status === "Close"
                    ? `
                          <a style="color: red;">Delete</a>
                        `
                    : ""
                }
              </div>
            </td>
            <td>
              <div class="action">
                <!-- Edit option -->
                <a href="#" onclick="editLead(event, ${lead.id})">Edit</a>
            </td>
          `;
                        leadData.appendChild(row);
                      }
                    });
                })
                .catch((error) => {
                  console.error("Error fetching data: " + error);
                });
            }

            // Function to handle editing a lead
            function editLead(event, leadId) {
              event.preventDefault();
              const existingEditSections =
                document.querySelectorAll(".edit-section");
              existingEditSections.forEach((section) => section.remove());

              const row = document.querySelector(
                `tr[data-lead-id="${leadId}"]`
              );

              // Create and append the edit section
              const editSection = document.createElement("tr");
              editSection.classList.add("edit-section");
              editSection.innerHTML = `
            <td colspan="6">
              <!-- Your edit form or content goes here -->
              <label for="newFollowUpDate">New Follow-Up Date:</label>
              <input type="date" id="newFollowUpDate" placeholder="DD/MM/YYYY" style="text-transform: uppercase; vertical-align: middle; margin-left: 5px; font-size:10px;">
              <label style="margin-left:10px" for="newComment">New Comment:</label>
              <textarea id="newComment" rows="1" style="vertical-align: middle; margin-left: 5px;" placeholder="Add new comment"></textarea>
              <button class="main-btn primary-btn btn-hover" style="height: 5px; width: 5px; vertical-align: middle; margin-left: 5px; font-size:14px;" onclick="saveEdits(${leadId})">Save</button>
            </td>

          `;
              row.insertAdjacentElement("afterend", editSection);
            }

            function saveEdits(leadId) {
              const newFollowUpDateInput =
                document.getElementById("newFollowUpDate");
              const newCommentInput = document.getElementById("newComment");

              const newFollowUpDate = newFollowUpDateInput.value;
              const newComment = newCommentInput.value;

              // Fetch API to send data to the server
              const url = `http://localhost:8080/save-edits/${leadId}`;
              fetch(url, {
                method: "POST",
                headers: {
                  "Content-Type": "application/x-www-form-urlencoded",
                },
                body: `newFollowUpDate=${newFollowUpDate}&newComment=${newComment}`,
              })
                .then((response) => {
                  if (!response.ok) {
                    throw new Error("Error saving edits");
                  }
                  return response.text();
                })
                .then((data) => {
                  console.log(data); // Log the response from the server
                  // Remove the edit section after saving
                  const editSection = document.querySelector(".edit-section");
                  editSection.remove();

                  // Update the calendar and table entry simultaneously
                  const row = document.querySelector(
                    `tr[data-lead-id="${leadId}"]`
                  );
                  const followDateCell = row.querySelector("td:nth-child(4)");
                  followDateCell.textContent = newFollowUpDate;

                  const commentCell = row.querySelector("td:nth-child(3)");
                  commentCell.textContent = newComment;

                  // Remove the row from the table
                  row.remove();

                  // Update the calendar with the removed lead's date
                  updateCalendarAfterRemove(removedLeadDate);
                })
                .catch((error) => {
                  console.error("Error:", error);
                  // Handle the error, show an alert, or perform other actions
                });
            }

            function getButtonClass(status) {
              switch (status) {
                case "Active":
                  return "newbtnact";
                case "Done":
                  return "newbtndone";
                case "Close":
                  return "newbtnclose";
                case "Pending":
                  return "newbtnpending";
                default:
                  return "default-btn"; // You can define a default class for other statuses
              }
            }

            function showConfirmationDialog(selectedStatus, row) {
              const currentStatus =
                row.querySelector("td:nth-child(5)").textContent;
              return confirm(
                `Do you want to change status from ${currentStatus} to ${selectedStatus}?`
              );
            }

            function changeStatus(selectElement) {
              const selectedStatus = selectElement.value;
              const row = selectElement.closest("tr");
              const leadId = row.dataset.leadId;

              if (!showConfirmationDialog(selectedStatus, row)) {
                // User clicked Cancel in the confirmation dialog
                selectElement.value =
                  row.querySelector("td:nth-child(5)").textContent;
                return;
              }

              const followDateCell = row.querySelector("td:nth-child(4)");

              if (selectedStatus === "Done" || selectedStatus === "Close") {
                // Update the follow date to empty when the status is "Done" or "Close"
                const removedLeadDate = followDateCell.textContent;
                followDateCell.textContent = "";

                // Remove the row from the table
                row.remove();

                // Update the calendar with the removed lead's date
                updateCalendarAfterRemove(removedLeadDate);
              }

              fetch(`http://localhost:8080/update-lead/${leadId}`, {
                method: "PUT",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({ status: selectedStatus }),
              })
                .then((response) => {
                  if (!response.ok) {
                    throw new Error("Network response was not ok");
                  }
                  return response.json();
                })
                .then((updatedStatus) => {
                  const statusCell = row.querySelector("td:nth-child(5)");
                  const actionCell = row.querySelector("td:nth-child(6)");

                  statusCell.textContent = selectedStatus;
                  statusCell.className = getButtonClass(selectedStatus);
                  actionCell.innerHTML = getActionHTML(
                    selectedStatus,
                    row.cells[0].textContent,
                    row.cells[2].textContent
                  );
                })
                .catch((error) => {
                  console.error("Error updating status: " + error);
                });
            }

            function updateCalendarAfterRemove(removedLeadId) {
              // Fetch the updated lead data and update the calendar
              fetch("http://localhost:8080/get-lead-data-dashboard")
                .then((response) => response.json())
                .then((data) => {
                  const filteredLeads = data.filter(
                    (lead) => lead.id !== removedLeadId
                  );

                  // Update the calendar with the filtered leads
                  updateCalendar(filteredLeads);
                })
                .catch((error) => {
                  console.error("Error fetching data: " + error);
                });
            }

            function getUpdatedCalendarEntries(removedLeadDate) {
              const calendarEntries = { ...calendarEntries };
              if (calendarEntries.hasOwnProperty(removedLeadDate)) {
                calendarEntries[removedLeadDate] -= 1;
              }
              return calendarEntries;
            }

            function getActionHTML(status, name, email) {
              if (status === "Done") {
                return `
            <a href="invoice.html?leadName=${name}&leadEmail=${email}" class="create-invoice-link">
                Invoice
            </a>
        `;
              } else if (status === "Close") {
                return `
            <a style="color: red;">Delete</a>
        `;
              } else if (status === "Active") {
                return `
          <select onchange="changeStatus(this)">
                <option value="" ${
                  status === "Active" ? "selected" : ""
                }>Edit</option>
                <option value="Pending" ${
                  status === "Pending" ? "selected" : ""
                }>Pending</option>
                <option value="Done" ${
                  status === "Done" ? "selected" : ""
                }>Done</option>
                <option value="Close" ${
                  status === "Close" ? "selected" : ""
                }>Close</option>
            </select>
          `;
              } else if (status === "Pending") {
                return `
          <select onchange="changeStatus(this)">
                <option value="" ${
                  status === "Pending" ? "selected" : ""
                }>Edit</option>
                <option value="Active" ${
                  status === "Active" ? "selected" : ""
                }>Active</option>
                <option value="Done" ${
                  status === "Done" ? "selected" : ""
                }>Done</option>
                <option value="Close" ${
                  status === "Close" ? "selected" : ""
                }>Close</option>
            </select>
          `;
              } else {
                return "";
              }
            }

            const dateInput = document.getElementById("followDateInput");
            dateInput.addEventListener("change", function () {
              let selectedDate = dateInput.value; // Get the selected date from the input

              // If no date is selected, default to the current date
              if (!selectedDate) {
                const currentDate = new Date();
                const year = currentDate.getFullYear();
                const month = String(currentDate.getMonth() + 1).padStart(
                  2,
                  "0"
                );
                const day = String(currentDate.getDate()).padStart(2, "0");
                selectedDate = `${year}-${month}-${day}`;
                dateInput.value = selectedDate; // Set the input value to the default date
              }

              fetchLeadsByDate(selectedDate);
            });

            // Trigger the change event to fetch data for the default date on page load
            dateInput.dispatchEvent(new Event("change"));
          </script>
        </div>
      </section>
    </main>
  </body>
</html>
