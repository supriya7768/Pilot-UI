<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="assets/images/favicon.svg" type="image/x-icon" />
    <title>Shepherd</title>

    <!-- ========== All CSS files linkup ========= -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css" />
    <link rel="stylesheet" href="assets/css/lineicons.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="assets/css/materialdesignicons.min.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="assets/css/fullcalendar.css" />
    <link rel="stylesheet" href="assets/css/fullcalendar.css" />
    <link rel="stylesheet" href="assets/css/main.css" />
    <style>
      td{
        color: grey;
        font-size: 12px;
        margin:10px;
        align-items: center;
      }
      
    </style>
  </head>
  <body>
    <!-- ======== Preloader =========== -->
    <div id="preloader">
      <div class="spinner"></div>
    </div>
    <!-- ======== Preloader =========== -->

   <!-- ======== sidebar-nav start =========== -->
   <aside class="sidebar-nav-wrapper">
    <div class="navbar-logo">
      <a href="index.html">
        <h2>Shepherd</h2>
      </a>
    </div>
    <nav class="sidebar-nav">
      <ul>
        <li class="nav-item">
          <a href="index.html">
            <span class="icon">
              <img class="hi" src="./assets/images/dashboard.png" alt="">
            </span>
            <span class="text">Dashboard</span>
          </a>
        </li>
      </ul>
          
          
      <nav class="sidebar-nav">
        <ul>
          <li class="nav-item">
            <a href="addlead.html">
              <span class="icon">
                <img class="hi" src="./assets/images/user.png" alt="" />
              </span>
              <span class="text">Add Lead</span>
            </a>
          </li>
        </ul>
      </nav>
      <nav class="sidebar-nav">
        <ul>
          <li class="nav-item">
            <a href="leadlist.html">
              <span class="icon">
                <img class="hi" src="./assets/images/group.png" alt="" />
              </span>
              <span class="text">Lead List</span>
            </a>
          </li>
        </ul>
      </nav>
      <nav class="sidebar-nav">
        <ul>
          <li class="nav-item">
            <a href="invoice.html">
              <span class="icon">
                <img class="hi" src="./assets/images/invoice.png" alt="" />
              </span>
              <span class="text">Invoice</span>
            </a>
          </li>
        </ul>
      </nav>
      <nav class="sidebar-nav">
        <ul>
          <li class="nav-item">
            <a href="studentpanel.html">
              <span class="icon">
                <img class="hi" src="./assets/images/students.png" alt="" />
              </span>
              <span class="text">Student Panel</span>
            </a>
          </li>
        </ul>
      </nav>
      
    </aside>
    <div class="overlay"></div>
    <!-- ======== sidebar-nav end =========== -->

    <!-- ======== main-wrapper start =========== -->
    <main class="main-wrapper">
        <!-- ========== header start ========== -->
        <header class="header">
          <div class="container-fluid">
            <div class="row">
              <div class="col-lg-5 col-md-5 col-6">
                <div class="header-left d-flex align-items-center">
                  <div class="menu-toggle-btn mr-15">
                    <button id="menu-toggle" class="main-btn primary-btn btn-hover">
                      <i class="lni lni-chevron-left me-2"></i> Menu
                    </button>
                  </div>
                  <div class="header-search d-none d-md-flex">
                    <form action="#">
                      <input type="text" placeholder="Search..." />
                      <button><i class="lni lni-search-alt"></i></button>
                    </form>
                  </div>
                </div>
              </div>
              <div class="col-lg-7 col-md-7 col-6">
                <div class="header-right">
                 
                </div>
              </div>
            </div>
          </div>
        </header>
        <!-- ========== header end ========== -->
  
        <!-- ========== section start ========== -->
        <section class="section">
          <div class="container-fluid">
            <!-- ========== title-wrapper start ========== -->
            <div class="title-wrapper pt-30">
              <div class="row align-items-center">
                <div class="col-md-6">
                  <div class="title">
                    <h2>Student List</h2>
                  </div>
                </div>
                
              </div>
              <!-- end row -->
            </div>

            <div class="row">
              <div class="col-lg-12">
                <div class="card-style mb-30">
                  <h6 class="mb-10">Data Table</h6>
                  <!-- <p class="text-sm mb-20">
                    For basic styling—light padding and only horizontal
                    dividers—use the class table.
                  </p> -->
                  <div class="table-wrapper table-responsive">
                    <table class="table">
                      <thead>
                        <tr>
                          <th>
                            <h6>Name</h6>
                          </th>
                          <th>
                            <h6>Mobile No</h6>
                          </th>
                          <th>
                            <h6>Email</h6>
                          </th>
                          <th>
                            <h6>Course</h6>
                          </th>
                          <th>
                            <h6>Status</h6>
                          </th>
                          <th>
                            <h6>Action</h6>
                          </th>
                        
                        </tr>
                        <!-- end table row-->
                    
                        
                          <tbody id="leadData">
                            <!-- Lead data will be dynamically added here -->

                        </tbody>

                        
                        <!-- end table row -->
                      </tbody>
                    </table>
                    <!-- end table -->
                  </div>
                </div>
                <!-- end card -->
              </div>
              <!-- end col -->
            </div>
            <!-- end row -->
          </div>
          <!-- ========== tables-wrapper end ========== -->
        </div>
        <!-- end container -->
      </section>
      <!-- ========== table components end ========== -->
            <!-- ========== title-wrapper end ========== -->
          </div>
          <!-- end container -->
        </section>
        <!-- ========== section end ========== -->

        

      </main>
      <!-- ======== main-wrapper end =========== -->
  
       <!-- ========= All Javascript files linkup ======== -->
    <script src="assets/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/Chart.min.js"></script>
    <script src="assets/js/dynamic-pie-chart.js"></script>
    <script src="assets/js/moment.min.js"></script>
    <script src="assets/js/fullcalendar.js"></script>
    <script src="assets/js/jvectormap.min.js"></script>
    <script src="assets/js/world-merc.js"></script>
    <script src="assets/js/polyfill.js"></script>
    <script src="assets/js/main.js"></script>
    <script src="assets/js/jquery.js"></script>
    <!-- <script src="assets/js/user.js"></script> -->
    <script>
      function fetchLeadData() {
        fetch("http://localhost:8080/get-lead-data")
          .then((response) => response.json())
          .then((data) => {
            const leadData = document.getElementById("leadData");
            // Clear existing data
            leadData.innerHTML = "";

            data
              .filter(
                (lead) => lead.status === "Done" || lead.status === "Close"
              )
              .forEach((lead) => {
                const row = document.createElement("tr");
                // Set the lead id as a data attribute
                row.dataset.leadId = lead.id; // Assuming lead has a property called 'id'

                // Check if the status is "Done" or "Close"
                const followOnContent =
                  lead.status === "Done" || lead.status === "Close"
                    ? "" // Set to empty if status is "Done" or "Close"
                    : `<input id="follow" type="date" />`;

                row.innerHTML = `
                      <td>${lead.name}</td>
                      <td>${lead.mobile}</td>
                      <td>${lead.email}</td>
                      <td>${lead.courseIntrested}</td>
                      <td>${lead.status}</td>
                      <td>
                          <div class="action">
                              ${
                                lead.status === "Pending"
                                  ? `
                                      <select onchange="changeStatus(this)">
                                          <option value="">Edit</option>
                                          <option value="Active">Active</option>
                                          <option value="Done">Done</option>
                                          <option value="Close">Close</option>
                                      </select>
                                  `
                                  : lead.status === "Active"
                                  ? `
                                      <select onchange="changeStatus(this)">
                                          <option value="">Edit</option>
                                          <option value="Pending">Pending</option>
                                          <option value="Done">Done</option>
                                          <option value="Close">Close</option>
                                      </select>
                                  `
                                  : lead.status === "Done"
                                  ? `
                                      <a href="invoice.html?leadName=${lead.name}&leadEmail=${lead.email}" class="create-invoice-link">
                                          Invoice
                                      </a>
                                  `
                                  : lead.status === "Close"
                                  ? `
                                      <a style="color: red;">Delete</a>
                                  `
                                  : ""
                              }
                          </div>
                      </td>
                  `;

                // console.log(row);
                leadData.appendChild(row);
              });
          })
          .catch((error) => {
            console.error("Error fetching data: " + error);
          });
      }

      function getButtonClass(status) {
        switch (status) {
          case "Active":
            return "newbtnact";
          case "Done":
            return "newbtndone";
          case "Close":
            return "newbtnclose";
          case "Pending":
            return "newbtnpending";
          default:
            return "default-btn"; // You can define a default class for other statuses
            }
        }
        
        function changeStatus(selectElement) {
            const selectedStatus = selectElement.value;
            console.log(selectedStatus);
            const row = selectElement.closest('tr');
            const statusCell = row.querySelector('td:nth-child(5)');
            const actionCell = row.querySelector('td:nth-child(6)');
        
            if (selectedStatus === 'done') {
                if (confirm('Do you want to change status as Done?')) {
                    statusCell.textContent = selectedStatus;
                    statusCell.className = getButtonClass(selectedStatus);
                    // Change action cell content to a link to invoice.html with name and email
                    actionCell.innerHTML = getActionHTML(selectedStatus, row.cells[0].textContent, row.cells[2].textContent);
                } else {
                    // Revert to the previous status (assuming you have a way to track it)
                    selectElement.value = statusCell.textContent;
                }
            } else {
                statusCell.textContent = selectedStatus;
                statusCell.className = getButtonClass(selectedStatus);
                actionCell.innerHTML = getActionHTML(selectedStatus);
            }
        }
        
        
        
        // Rest of your code...
        
        
        function getActionHTML(status, name, email) {
            if (status === 'done') {
                return `
                    <a href="invoice.html?leadName=${name}&leadEmail=${email}" class="create-invoice-link">
                        Invoice
                    </a>
                `;
            } else if (status === 'close') {
                return `
                    <a style="color: red;">Delete</a>
                `;
            } else if (status === 'active') {
                return `
                    <select onchange="changeStatus(this)">
                        <option value="">Edit</option>
                        <option value="pending">Pending</option>
                        <option value="done">Done</option>
                        <option value="close">Close</option>
                    </select>
                `;
            } else if (status === 'pending') {
                return `
                    <select onchange="changeStatus(this)">
                        <option value="">Edit</option>
                        <option value="active">Active</option>
                        <option value="done">Done</option>
                        <option value="close">Close</option>
                    </select>
                `;
            } else {
                return '';
            }
        }
        
        
        // Call the fetchLeadData function when the page loads
        window.onload = fetchLeadData;
        
      </script>
    </body>
  </html>